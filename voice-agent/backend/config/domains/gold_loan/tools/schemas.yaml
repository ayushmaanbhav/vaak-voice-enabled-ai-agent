# Gold Loan Domain - Tool Schemas
# Defines LLM tool definitions in JSON Schema compatible format
#
# DOMAIN-AGNOSTIC DESIGN:
# - parameter_aliases: Maps generic parameter names to domain-specific aliases
# - tool_defaults: Configurable default values (no hardcoded values in Rust)
# - All domain-specific terms in descriptions support variable substitution

# Parameter aliases for backward compatibility and domain flexibility
# Generic names (used in code) -> Domain-specific aliases (accepted from input)
parameter_aliases:
  # Asset-related parameters
  collateral_weight:
    - "gold_weight_grams"
    - "weight_grams"
    - "weight"
    - "asset_weight"
    - "quantity"
  collateral_variant:
    - "gold_purity"
    - "purity"
    - "quality"
    - "asset_quality"
    - "grade"
  collateral_type:
    - "gold_type"
    - "item_type"
    - "asset_type"

  # Financial parameters
  offer_amount:
    - "loan_amount"
    - "amount"
    - "principal"
  current_offer_amount:
    - "current_loan_amount"
    - "existing_amount"
  service_provider:
    - "lender"
    - "current_lender"
    - "provider"
  annual_rate:
    - "interest_rate"
    - "rate"
    - "current_interest_rate"

# Tool-specific default values (moved from hardcoded Rust values)
tool_defaults:
  check_eligibility:
    default_variant: "22K"  # Was hardcoded in eligibility.rs
    min_weight: 1.0
    max_weight: 10000.0

  compare_providers:
    default_amount: 100000  # Was hardcoded 100000 in competitor.rs
    default_tenure_months: 12  # Was hardcoded 12 in competitor.rs
    default_competitor: "all"

  calculate_savings:
    interest_rate_min: 10.0  # Was hardcoded 10.0 in savings.rs
    interest_rate_max: 30.0  # Was hardcoded 30.0 in savings.rs
    default_tenure_months: 12
    default_lender: "Other"  # Was hardcoded "Other Lender" in savings.rs

  find_locations:
    max_results: 5  # Was hardcoded 5 in branch_locator.rs
    default_radius_km: 10

  capture_lead:
    interest_level_default: "Medium"  # Was hardcoded "Medium" in lead_capture.rs
    interest_levels: ["High", "Medium", "Low"]

  get_document_checklist:
    customer_type_default: "individual"  # Was hardcoded in document_checklist.rs
    existing_customer_default: false
    customer_types: ["individual", "business", "nri"]
    service_types: ["new_loan", "balance_transfer", "top_up", "renewal"]

  schedule_appointment:
    time_slots: ["10:00 AM", "11:00 AM", "12:00 PM", "2:00 PM", "3:00 PM", "4:00 PM", "5:00 PM"]
    purposes: ["New Application", "Transfer", "Top-up", "Closure", "Consultation"]
    default_purpose: "New Application"

  send_sms:
    default_customer_name: "Customer"  # Was hardcoded "Customer" in sms.rs
    message_types: ["appointment_confirmation", "appointment_reminder", "follow_up", "welcome", "promotional"]

tools:
  check_eligibility:
    name: check_eligibility
    description: "Check if customer is eligible for a gold loan based on their gold weight and purity"
    category: "calculation"
    metadata:
      display_name: "Eligibility Check"
      icon: "calculator"
      requires_domain_config: true
      requires_integrations: false
      timeout_secs: 30
      aliases: []
      # P22 FIX: Execution type for factory-based tool creation
      execution_type: "calculation"
      calculator_method: "check_eligibility"
    parameters:
      - name: gold_weight_grams
        type: number
        description: "Weight of gold in grams"
        required: true
        min: 1.0
        max: 10000.0
      - name: gold_purity
        type: string
        description: "Purity of gold (e.g., '22K', '18K')"
        required: false
        enum: ["24K", "22K", "18K", "14K"]
        default: "22K"
      - name: existing_loan_amount
        type: number
        description: "Existing loan amount if any (optional)"
        required: false
        min: 0.0

  calculate_savings:
    name: calculate_savings
    description: "Calculate monthly savings when switching from competitor to Kotak"
    category: "calculation"
    metadata:
      display_name: "Savings Calculator"
      icon: "piggy-bank"
      requires_domain_config: true
      requires_integrations: false
      timeout_secs: 30
      aliases: ["savings_calculator"]
      execution_type: "calculation"
      calculator_method: "calculate_savings"
    parameters:
      - name: current_lender
        type: string
        description: "Name of current lender (e.g., 'Muthoot', 'Manappuram')"
        required: true
      - name: current_interest_rate
        type: number
        description: "Current interest rate in percentage"
        required: false
        min: 0.0
        max: 50.0
      - name: current_loan_amount
        type: number
        description: "Current loan amount in INR"
        required: false
        min: 1000.0
        max: 100000000.0
      - name: remaining_tenure_months
        type: integer
        description: "Remaining tenure in months"
        required: false
        min: 1
        max: 360

  find_locations:
    name: find_locations
    description: "Find nearby Kotak Mahindra Bank branches that offer gold loans"
    category: "location"
    metadata:
      display_name: "Branch Locator"
      icon: "location"
      requires_domain_config: true
      requires_integrations: false
      timeout_secs: 30
      aliases: ["find_branches", "branch_locator"]
      execution_type: "lookup"
    parameters:
      - name: city
        type: string
        description: "City name to search branches in"
        required: true
      - name: area
        type: string
        description: "Specific area or locality (optional)"
        required: false

  schedule_callback:
    name: schedule_callback
    description: "Schedule a callback from Kotak branch team"
    category: "communication"
    metadata:
      display_name: "Schedule Callback"
      icon: "phone"
      requires_domain_config: true
      requires_integrations: true
      timeout_secs: 60
      aliases: []
      execution_type: "integration"
    parameters:
      - name: phone
        type: string
        description: "Customer phone number (10 digits)"
        required: true
      - name: preferred_time
        type: string
        description: "Preferred callback time"
        required: false
        enum: ["morning", "afternoon", "evening"]

  send_sms:
    name: send_sms
    description: "Send SMS with loan details or promotional information to customer"
    category: "communication"
    metadata:
      display_name: "Send SMS"
      icon: "message"
      requires_domain_config: true
      requires_integrations: true
      timeout_secs: 30
      aliases: []
      execution_type: "integration"
    parameters:
      - name: phone
        type: string
        description: "Customer phone number (10 digits)"
        required: true
      - name: message_type
        type: string
        description: "Type of SMS message to send"
        required: true
        enum: ["eligibility_summary", "rate_comparison", "branch_info", "callback_confirmation"]

  get_price:
    name: get_price
    description: "Get current gold rate per gram for different purities"
    category: "information"
    metadata:
      display_name: "Get Price"
      icon: "gold"
      requires_domain_config: true
      requires_integrations: false
      timeout_secs: 30
      aliases: ["get_gold_price", "gold_rate"]
      execution_type: "lookup"
    parameters:
      - name: purity
        type: string
        description: "Gold purity to get rate for (optional, returns all if not specified)"
        required: false
        enum: ["24K", "22K", "18K"]
      - name: weight_grams
        type: number
        description: "Optional weight in grams to calculate total value"
        required: false
        min: 0.1

  compare_providers:
    name: compare_providers
    description: "Compare Kotak's gold loan offering with other lenders"
    category: "comparison"
    metadata:
      display_name: "Compare Providers"
      icon: "compare"
      requires_domain_config: true
      requires_integrations: false
      timeout_secs: 30
      aliases: ["compare_lenders", "competitor_comparison"]
      execution_type: "calculation"
    parameters:
      - name: competitor
        type: string
        description: "Competitor name to compare against"
        required: true
      - name: loan_amount
        type: number
        description: "Loan amount for comparison"
        required: false
        min: 10000.0
        max: 25000000.0

  capture_lead:
    name: capture_lead
    description: "Capture customer lead information for follow-up"
    category: "crm"
    metadata:
      display_name: "Capture Lead"
      icon: "user-plus"
      requires_domain_config: true
      requires_integrations: true
      timeout_secs: 60
      aliases: ["lead_capture"]
      execution_type: "integration"
    parameters:
      - name: name
        type: string
        description: "Customer name"
        required: true
      - name: phone
        type: string
        description: "Customer phone number"
        required: true
      - name: city
        type: string
        description: "Customer city"
        required: false
      - name: loan_amount_interest
        type: number
        description: "Loan amount the customer is interested in"
        required: false
      - name: gold_weight
        type: number
        description: "Gold weight customer mentioned"
        required: false
      - name: current_lender
        type: string
        description: "Customer's current lender if any"
        required: false
      - name: lead_source
        type: string
        description: "Source of the lead"
        required: false
        enum: ["voice_agent", "website", "branch_referral", "existing_customer"]

  schedule_appointment:
    name: schedule_appointment
    description: "Schedule a branch visit appointment for gold valuation"
    category: "scheduling"
    metadata:
      display_name: "Schedule Appointment"
      icon: "calendar"
      requires_domain_config: true
      requires_integrations: true
      timeout_secs: 60
      aliases: []
      execution_type: "integration"
    parameters:
      - name: customer_name
        type: string
        description: "Customer's name"
        required: true
      - name: phone_number
        type: string
        description: "Contact number (10 digits)"
        required: true
      - name: branch_id
        type: string
        description: "Branch ID or location"
        required: true
      - name: preferred_date
        type: string
        description: "Preferred date (YYYY-MM-DD)"
        required: true
      - name: preferred_time
        type: string
        description: "Preferred time slot"
        required: true
        enum: ["10:00 AM", "11:00 AM", "12:00 PM", "2:00 PM", "3:00 PM", "4:00 PM", "5:00 PM"]
      - name: purpose
        type: string
        description: "Purpose of visit"
        required: false
        enum: ["New Gold Loan", "Gold Loan Transfer", "Top-up", "Closure", "Consultation"]

  escalate_to_human:
    name: escalate_to_human
    description: "Transfer the call to a human agent when customer requests or when needed"
    category: "escalation"
    metadata:
      display_name: "Escalate to Human"
      icon: "user"
      requires_domain_config: false
      requires_integrations: false
      timeout_secs: 10
      aliases: ["escalate", "human_agent", "transfer_to_human"]
      execution_type: "generic"
    parameters:
      - name: reason
        type: string
        description: "Reason for escalation"
        required: false
        enum: ["customer_request", "complex_query", "complaint", "technical_issue"]
      - name: priority
        type: string
        description: "Priority level for escalation"
        required: false
        enum: ["normal", "high", "urgent"]
        default: "normal"

  get_document_checklist:
    name: get_document_checklist
    description: "Get list of documents required for gold loan application"
    category: "information"
    metadata:
      display_name: "Document Checklist"
      icon: "document"
      requires_domain_config: true
      requires_integrations: false
      timeout_secs: 30
      aliases: ["document_checklist", "required_documents"]
      execution_type: "lookup"
    parameters:
      - name: loan_type
        type: string
        description: "Type of loan application"
        required: false
        enum: ["new_loan", "balance_transfer", "top_up", "renewal"]
        default: "new_loan"
      - name: customer_type
        type: string
        description: "Type of customer"
        required: false
        enum: ["individual", "business", "nri"]
        default: "individual"

# Tool usage guidelines for the LLM
usage_guidelines:
  general: |
    Only use tools when the customer's request requires specific calculations or data lookup.
    For general conversation, respond naturally without tools.

  eligibility: |
    Use check_eligibility when customer asks about loan amount they can get,
    or wants to know if they qualify for a gold loan.

  savings: |
    Use calculate_savings when customer mentions their current lender and rate,
    or asks how much they would save by switching.

  branches: |
    Use find_branches when customer asks about branch locations or wants to visit.

  callback: |
    Use schedule_callback when customer requests a callback or wants to be contacted.

  lead_capture: |
    Use capture_lead at conversation end when customer shows interest and provides contact info.

# P16 FIX: Intent to Tool Mapping
# Maps detected intents to appropriate tools with optional slot requirements
# This replaces hardcoded intent-to-tool mappings in the agent code
intent_to_tool:
  # Eligibility checking
  eligibility_check:
    tool: check_eligibility
    required_slots:
      - gold_weight

  # Balance transfer / switching lender
  switch_lender:
    tool: calculate_savings
    required_slots:
      - current_lender

  balance_transfer:
    tool: calculate_savings
    required_slots:
      - current_lender

  # Branch/location inquiries
  schedule_visit:
    tool: find_locations
    required_slots: []

  branch_inquiry:
    tool: find_locations
    required_slots: []

  # Lead capture when customer shows interest
  capture_lead:
    tool: capture_lead
    required_slots:
      - customer_name
      - phone_number

  interested:
    tool: capture_lead
    required_slots:
      - phone_number

  callback_request:
    tool: capture_lead
    required_slots:
      - phone_number

  # Appointment scheduling
  schedule_appointment:
    tool: schedule_appointment
    required_slots:
      - preferred_date
    fallback_tool: find_locations

  book_appointment:
    tool: schedule_appointment
    required_slots:
      - preferred_date
    fallback_tool: find_locations

  visit_branch:
    tool: schedule_appointment
    required_slots:
      - preferred_date
    fallback_tool: find_locations

  # Price inquiry
  gold_price:
    tool: get_price
    required_slots: []

  check_gold_price:
    tool: get_price
    required_slots: []

  price_inquiry:
    tool: get_price
    required_slots: []

  current_rate:
    tool: get_price
    required_slots: []

  # Escalation to human
  escalate:
    tool: escalate_to_human
    required_slots: []

  human_agent:
    tool: escalate_to_human
    required_slots: []

  speak_to_person:
    tool: escalate_to_human
    required_slots: []

  talk_to_human:
    tool: escalate_to_human
    required_slots: []

  real_person:
    tool: escalate_to_human
    required_slots: []

  # SMS requests
  send_sms:
    tool: send_sms
    required_slots: []

  send_message:
    tool: send_sms
    required_slots: []

  text_me:
    tool: send_sms
    required_slots: []

  send_details:
    tool: send_sms
    required_slots: []

  sms_info:
    tool: send_sms
    required_slots: []
